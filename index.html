<!DOCTYPE html>
<html>
<head>
  <base target="_top">
  <?!= HtmlService.createHtmlOutputFromFile('Style').getContent(); ?>
  <style>
    /* Minimalny styl kafelkÃ³w */
    .day-section {
      margin-bottom: 30px;
    }
    .day-section h2 {
      margin-bottom: 10px;
    }
    .grid {
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
    }
    .card {
      border: 1px solid #ccc;
      border-radius: 8px;
      padding: 10px;
      width: 200px;
      background-color: #f9f9f9;
      box-shadow: 1px 1px 5px rgba(0,0,0,0.1);
    }
    .paid { color: red; font-weight: bold; }
    .free { color: green; font-weight: bold; }
  </style>
</head>
<body>
  <h1>ğŸ“… Lista zajÄ™Ä‡</h1>
  <div id="container">Åadowanie zajÄ™Ä‡...</div>

  <script>


      function openForm(zajecie) {
        const container = document.getElementById('container');

        // Tworzymy formularz
        const formDiv = document.createElement('div');
        formDiv.className = 'form-modal';
        formDiv.innerHTML = `
          <h3>Zapis na: ${zajecie.nazwa} (${zajecie.dzien} ${zajecie.godzina_od}-${zajecie.godzina_do})</h3>
          <label>ImiÄ™ i nazwisko dziecka: <input type="text" id="uczen"></label><br>
          <label>Klasa: <input type="text" id="klasa"></label><br>
          <label>ImiÄ™ i nazwisko rodzica: <input type="text" id="rodzic"></label><br>
          <button id="submitForm">Zapisz</button>
          <button id="cancelForm">Anuluj</button>
        `;

        container.prepend(formDiv);

        document.getElementById('submitForm').onclick = () => {
          const data = {
            id_zajecia: zajecie.id,
            nazwa: zajecie.nazwa,
            uczen: document.getElementById('uczen').value.trim(),
            klasa: document.getElementById('klasa').value.trim(),
            rodzic: document.getElementById('rodzic').value.trim()
          };
          google.script.run.withSuccessHandler(msg => {
            alert(msg);
            formDiv.remove();
          }).zapiszDziecko(data);
        };

        document.getElementById('cancelForm').onclick = () => {
          formDiv.remove();
        };
      }



    // Pobranie danych z Apps Script
    google.script.run.withSuccessHandler(render).getZajeciaList();

    function render(data) {
      const container = document.getElementById('container');
      container.innerHTML = ''; // czyÅ›cimy napis "Åadowanie"

      if (!data || data.length === 0) {
        container.textContent = 'Brak zajÄ™Ä‡ do wyÅ›wietlenia.';
        return;
      }

      // Grupowanie zajÄ™Ä‡ po dniach
      const grouped = {};
      data.forEach(z => {
        if (!grouped[z.dzien]) grouped[z.dzien] = [];
        grouped[z.dzien].push(z);
      });

      Object.keys(grouped).forEach(dzien => {
        const daySection = document.createElement('div');
        daySection.className = 'day-section';

        const title = document.createElement('h2');
        title.textContent = dzien;
        daySection.appendChild(title);

        const grid = document.createElement('div');
        grid.className = 'grid';

        grouped[dzien].forEach(z => {
          const card = document.createElement('div');
          card.className = 'card';

          card.innerHTML = `
            <h3>${z.nazwa}</h3>
            <p><strong>â°</strong> ${z.godzina_od} â€“ ${z.godzina_do}</p>
            <p><strong>ğŸ“ Klasa:</strong> ${z.klasa}</p>
            <p><strong>IloÅ›Ä‡ dostÄ™pnych miejsc!!:</strong> ${z.max_limit}</p>
            <p><strong>Czy dostepne!!:</strong> ${z.min_limit}</p>
            <p><strong>Czy zostanie uruchomione!!:</strong> ${z.min_limit}</p>
            <p class="${z.platne ? 'paid' : 'free'}">
              ${z.platne ? 'ğŸ’° PÅ‚atne' : 'âœ… BezpÅ‚atne'}
            </p>
          `;
          const button = document.createElement('button');
          button.textContent = 'Zapisz dziecko';
          button.onclick = () => openForm(z); // przekazujemy dane zajÄ™cia
          card.appendChild(button);
          grid.appendChild(card);
        });

        daySection.appendChild(grid);
        container.appendChild(daySection);
      });
    }
  </script>
</body>
</html>
